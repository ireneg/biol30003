---
title: 'BIOL30003: Epidemics on Networks I'
author: "Nic Geard"
date: "15 August 2017"
output: 
  html_document: default
layout: page
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(igraph)
```

The primary aim of this practical is to gain some familiarity with using the igraph library to generate random networks using a few simple models, read a network from an external file, and calculate and plot some basic properties of these networks.  In the next couple of weeks, we will implement our own graph generator, and model disease transmission on these networks.

### Installing the igraph library

igraph is a collection of tools for creating, manipulating and analysing networks. For more information on the igraph R library see <http://igraph.org/r/>.

igraph is on CRAN and can be installed from within R:

```{r, eval=FALSE}
## Download and install the package
install.packages("igraph")

## Load package
library(igraph)
```
 
### Generating random networks

Several models have been proposed for generating random networks that exhibit particular properties.  One of the earliest and simplest of these is the Erdős–Rényi (ER) model, proposed by Paul Erdős and Alfréd Rényi in 1959.

There are two related variants of this model:

* _G(N,M)_: a graph containing _N_ nodes is created and _M_ edges are chosen uniformly at random from the set of all possible edges; and

* _G(N,p)_: a graph containing _N_ nodes is created and possible edge is added with probability _p_.

We can create graphs generated by these models using the `sample_gnm` and `sample_gnp` commands; for example:

```{r igraph}
## create a network with 25 nodes and 75 edges (chosen at random)
## directed: specifies whether edges are directed (defaults to FALSE)
## loops: specifies whether edges from a node to itself are allowed (defaults to FALSE)
g <- sample_gnm(n=25, m=75, directed=FALSE, loops=FALSE)
```

### Obtaining information about a network

igraph provides a number of functions to display information about a network:

* `vcount(g)` returns the number of nodes (or vertices) in the network

* `ecount(g)` returns the number of edges in the network

* `V(g)` and `E(g)` return sequences of the nodes and edges respectively

* `neighbors(g, x)` returns a sequence of the nodes adjacent to node `x` (ie, that are connected to `x` by an edge)  Note US spelling!

* `are.connected(g, x, y)` returns `TRUE` if `x` and `y` are connected, otherwise `FALSE`

* `plot(g)` will visualise your graph; try `plot(g, layout=layout.fruchterman.reingold, vertex.size=5, vertex.label.dist=2)` for a slightly nicer looking visualisation

Try out these functions on a couple of networks generated using the two ER models.  What difference can you detect between the networks generated by the two models?

**Exercise**: Generate 1,000 networks using the _G(N,p)_ model a plot a histogram of their edge counts. (hint: `lapply` will be helpful!)

### Modifying a network

igraph also provides functions for adding and deleting nodes and edges:

* `add_vertices(g, nv)` adds `nv` new nodes to graph `g`

* `add_edges(g, edges)` adds `edges` to `g`, where `edges` is a sequence of nodes to be linked; for example `edges=c(1,2, 3,4)` would specify that two new edges were to be created linking nodes 1 and 2, and nodes 3 and 4, respectively

* corresponding functions `delete_vertices` and `delete_edges` allow you to remove nodes and edges from a graph.  Note that an edge between nodes `x` and `y` can be indicated as `"x|y"`.

**Exercise**: Starting with an empty undirected graph (`g <- graph.empty(directed=FALSE)`) use the above functions to create a network in the shape of a pentagon containing a pentagram.

### Reading a network from an external file

igraph can also create networks based on information stored in an external file.  Download the file `flu-data.zip` (19.8MB) from <http://sing.stanford.edu/flu/> and unzip it somewhere.  This archive contains raw and processed data from the Stanford Flu Spread Study, described in Salathé et al. A high-resolution human contact network for infectious disease transmission, _PNAS_, 2010.

You can refer to the paper and readme files in the archive for more information about how the data were collected and processed. Here, we will use the following file (nb: long path split over multiple lines): `flu-data/edgeLists/durationCondition/ ...`
`addThenChop/dropoff=0/minimumDuration=1/deltaT=1620/ ...` `staticWeightedEdgeList_at=1350_min=540_max=2159.txt`

The format of this file is quite simple: three columns of numbers specifying the source node, destination node, and weight of each edge.  Load this file into a graph as follows (you may need to alter the path to the file):

```{r, eval=FALSE}
g <- read_graph('staticWeightedEdgeList_at=1350_min=540_max=2159.txt', format='ncol', directed=FALSE)
```

The weights for each edge are stored in the `weight` attribute, and can be retrieved using `E(g)$weight`.  Read about how these weights have been calculated.

**Exercise**: How many edges are in this network?  What does the distribution of edge weights look like?  Create a copy of the network in which you delete all edges whose weight is less than some specified value.  How does the density of the network change depending on the choice you make for this value?  What do you think might constitute a "sensible" cutoff?

### Additional activities

1. Explore some of the other generating functions in igraph, such as `sample_smallworld` and `sample_pa`.  You can use `?<function.name>` to get more information about the parameters of each function.

2. Explore some of the other functions for calculating network properties, such as `degree_distribution`, `diameter`, `transitivity` (also known as clustering coefficient), `average.path.length` and `components`.

3. (more challenging) Try generating some of the plots from Figure 2 of the Salathé _PNAS_ paper.


